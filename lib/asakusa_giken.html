<!-- BLEIo in -->
<script type='text/x-red' data-template-name='BLEIo in'>
  <div class='form-row'>
    <label for='node-input-name'>
      <i class='fa fa-tag'></i>
      <span data-i18n='node-red:common.label.name'></span>
    </label>
    <input type='text' id='node-input-name' data-i18n='[placeholder]node-red:common.label.name'>
  </div>
  <div class="form-row node-input-bleio">
    <label for="node-input-bleio">
      <i class="fa fa-random"></i>
      <span data-i18n="asakusa_giken.label.bleio"></span></label>
    <input type="text" id="node-input-bleio">
  </div>
  <div class="form-row" id="node-useString">
    <label>&nbsp;</label>
    <input type="checkbox" id="node-input-useString" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-input-useString" style="width: 70%;" data-i18n="asakusa_giken.label.useString"></label>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLEIo in',{
    category: 'input',
    defaults: {
      name: { name: '' },
      bleio: { type: 'BLEIo', required: true },
      useString: { value: false, required: false }
    },
    color: 'Pink',
    inputs: 0,
    outputs: 1,
    icon: "bridge-dash.png",
    label: function() {
      return this.name || 'BLEIo';
    },
    labelStyle: function() {
      return this.name ? 'node_label_italic' : '';
    }
  });
</script>

<!-- BLEIo out -->
<script type='text/x-red' data-template-name='BLEIo out'>
  <div class='form-row'>
    <label for='node-input-name'>
      <i class='fa fa-tag'></i>
      <span data-i18n='node-red:common.label.name'></span>
    </label>
    <input type='text' id='node-input-name' data-i18n='[placeholder]node-red:common.label.name'>
  </div>
  <div class="form-row node-input-bleio">
    <label for="node-input-bleio">
      <i class="fa fa-random"></i>
      <span data-i18n="asakusa_giken.label.bleio"></span></label>
    <input type="text" id="node-input-bleio">
  </div>
  <div class="form-row" id="node-useString">
    <label>&nbsp;</label>
    <input type="checkbox" id="node-input-useString" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-input-useString" style="width: 70%;" data-i18n="asakusa_giken.label.useString"></label>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLEIo out',{
    category: 'output',
    defaults: {
      name: { name: '' },
      bleio: { type: 'BLEIo', required: true },
      useString: { value: false, required: false }
    },
    color: 'Pink',
    inputs: 1,
    outputs: 0,
    icon: "bridge-dash.png",
    align: 'right',
    label: function() {
      return this.name || 'BLEIo';
    },
    labelStyle: function() {
      return this.name ? 'node_label_italic' : '';
    }
  });
</script>

<!-- BLEIo -->
<script type='text/x-red' data-template-name='BLEIo'>
  <div class='form-row'>
    <label for='node-config-input-localName'>
      <i class='fa fa-tag'></i>
      <span data-i18n='asakusa_giken.label.localName'></span>
    </label>
    <select type='text' id='node-config-input-localName' style='width: 72%;'>
    </select>
  </div>
  <div class='form-row'>
    <label for='node-config-input-address'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.address'></span>
    </label>
    <input type='text' id='node-config-input-address' data-i18n='[placeholder]asakusa_giken.placeholder.optionalAddress'>
  </div>
  <div class='form-row'>
    <label for='node-config-input-uuid'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.uuid'></span>
    </label>
    <input type='text' id='node-config-input-uuid' data-i18n='[placeholder]asakusa_giken.placeholder.uuid'>
  </div>
  <div class="form-row node-config-input-initInterval">
    <label for="node-input-initInterval">
      <i class="fa fa-edit"></i>
      <span data-i18n="asakusa_giken.label.initInterval"></span></label>
    <input type="text" id="node-config-input-initInterval" maxlength="5" data-i18n='[placeholder]asakusa_giken.placeholder.initInterval'>
  </div>
  <div class="form-row" id="node-config-input-initDout1">
    <label for='node-config-input-initDout'>
      <i class='fa fa-edit'></i>
      <span data-i18n='asakusa_giken.label.initDout'></span>
    </label>

    <input type="checkbox" id="node-config-input-dout1" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout1" style="width: auto;" data-i18n="asakusa_giken.label.dout1"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout2" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout2" style="width: auto;" data-i18n="asakusa_giken.label.dout2"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout3" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout3" style="width: auto;" data-i18n="asakusa_giken.label.dout3"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout4" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout4" style="width: auto;" data-i18n="asakusa_giken.label.dout4"></label>&nbsp;

  </div>
  <div class="form-row" id="node-config-input-initDout2">
    <label>&nbsp;</label>

    <input type="checkbox" id="node-config-input-dout5" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout5" style="width: auto;" data-i18n="asakusa_giken.label.dout5"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout6" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout6" style="width: auto;" data-i18n="asakusa_giken.label.dout6"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout7" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout7" style="width: auto;" data-i18n="asakusa_giken.label.dout7"></label>&nbsp;

    <input type="checkbox" id="node-config-input-dout8" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-config-input-dout8" style="width: auto;" data-i18n="asakusa_giken.label.dout8"></label>&nbsp;
  </div>
  <div class="form-row node-config-input-initLcd">
    <label for="node-config-input-initLcd">
      <i class="fa fa-edit"></i>
      <span data-i18n="asakusa_giken.label.initLcd"></span></label>
    <input type="text" id="node-config-input-initLcd" maxlength="16" data-i18n='[placeholder]asakusa_giken.placeholder.initLcd'>
  </div>
  <div class="form-row node-config-input-pwm1">
    <label for="node-config-input-pwm1">
      <i class="fa fa-edit"></i>
      <span data-i18n="asakusa_giken.label.initPwm1"></span></label>
    <input type="text" id="node-config-input-pwm1" maxlength="3" data-i18n='[placeholder]asakusa_giken.placeholder.initPwm'>
  </div>
  <div class="form-row node-config-input-pwm2">
    <label for="node-config-input-pwm2">
      <i class="fa fa-edit"></i>
      <span data-i18n="asakusa_giken.label.initPwm2"></span></label>
    <input type="text" id="node-config-input-pwm2" maxlength="3" data-i18n='[placeholder]asakusa_giken.placeholder.initPwm'>
  </div>
  <div class="form-row node-config-input-pwm3">
    <label for="node-config-input-pwm3">
      <i class="fa fa-edit"></i>
      <span data-i18n="asakusa_giken.label.initPwm3"></span></label>
    <input type="text" id="node-config-input-pwm3" maxlength="3" data-i18n='[placeholder]asakusa_giken.placeholder.initPwm'>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLEIo',{
    category: 'config',
    defaults: {
      localName: { value: '', required: true },
      address: { value: '', required: false },
      uuid: { value: '', required: false },
      initInterval: { value: '500', required: true },
      initDout: { value: '0', required: true },
      initLcd: { value: '', required: false },
      initPwm: { value: '0', required: true },
    },
    label: function() {
      return this.localName;
    },
    oneditprepare: function() {
      var localNames = [];
      var i;
      for (i = 0; i < 16; i++) {
        var n = 'BLEIo_' + i.toString(16).toUpperCase();
        localNames.push(n);
      }
      var that = this;
      RED.nodes.eachConfig(function(c) {
        if (c.type === 'BLEIo' && that.id !== c.id &&
            localNames.indexOf(c.localName) >= 0) {
          localNames.splice(localNames.indexOf(c.localName), 1);
        }
      });
      $('#node-config-input-localName').append(option);
      for (i = 0; i < localNames.length; i++) {
        var localName = localNames[i];
        var option = $('<option></option>').attr('value', localName)
          .text(localName);
        $('#node-config-input-localName').append(option);
      }
      $('#node-config-input-address').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().replace(new RegExp('-', 'g'), ':').trim());
        }
      });
      $('#node-config-input-uuid').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().trim());
        }
      });

      var dout = parseInt(this.initDout) || 0;
      // bit 0 = DOUT1 => bit 7 = DOUT8
      for (i = 1; i <= 8; i++) {
        $('#node-config-input-dout' + i).prop('checked', (dout & 1) === 1);
        dout >>= 1;
      }

      var pwm = parseInt(this.initPwm) || 0;
      // byte 0 = PWM1 => byte 2 = PWM3
      $('#node-config-input-pwm1').val((pwm & 0xFF0000) / 0x10000);
      $('#node-config-input-pwm2').val((pwm & 0x00FF00) / 0x100);
      $('#node-config-input-pwm3').val(pwm & 0x0000FF);
    },
    oneditsave: function() {
      var i;
      if (!this.initInterval || this.initInterval < 1) {
        this.initInterval = 1;
      } else if (this.initInterval > 60000) {
        this.initInterval = 60000;
      }
      this.initDout = 0;
      for (i = 8; i >= 1; i--) {
        this.initDout += $('#node-config-input-dout' + i).is(':checked') ? 1 : 0;
        this.initDout <<= 1;
      }
      this.initDout >>= 1;
      function truncate(v) {
        v = (parseInt(v) || 0);
        if (v < 0) {
          return 0;
        } else if (v > 100) {
          return 100;
        }
        return v;
      }
      this.initPwm =
        truncate($('#node-config-input-pwm1').val()) * 0x10000 +
        truncate($('#node-config-input-pwm2').val()) * 0x00100 +
        truncate($('#node-config-input-pwm3').val());
    }
  });
</script>


<!-- BLECAST_BL in -->
<script type='text/x-red' data-template-name='BLECAST_BL in'>
  <div class='form-row'>
    <label for='node-input-name'>
      <i class='fa fa-tag'></i>
      <span data-i18n='node-red:common.label.name'></span>
    </label>
    <input type='text' id='node-input-name' data-i18n='[placeholder]node-red:common.label.name'>
  </div>
  <div class="form-row node-input-blecastBl">
    <label for="node-input-blecastBl">
      <i class="fa fa-random"></i>
      <span data-i18n="asakusa_giken.label.blecastBl"></span></label>
    <input type="text" id="node-input-blecastBl">
  </div>
  <div class="form-row" id="node-useString">
    <label>&nbsp;</label>
    <input type="checkbox" id="node-input-useString" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-input-useString" style="width: 70%;" data-i18n="asakusa_giken.label.useString"></label>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLECAST_BL in',{
    category: 'input',
    defaults: {
      name: { name: '' },
      blecastBl: { type: 'BLECAST_BL', required: true },
      useString: { value: false, required: false }
    },
    color: 'SkyBlue',
    inputs: 0,
    outputs: 1,
    icon: "blecast_bl.png",
    label: function() {
      return this.name || 'BLECAST_BL';
    },
    labelStyle: function() {
      return this.name ? 'node_label_italic' : '';
    }
  });
</script>

<!-- BLECAST_BL -->
<script type='text/x-red' data-template-name='BLECAST_BL'>
  <div class='form-row'>
    <label for='node-config-input-address'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.address'></span>
    </label>
    <input type='text' id='node-config-input-address' data-i18n='[placeholder]asakusa_giken.placeholder.address'>
  </div>
  <div class='form-row'>
    <label for='node-config-input-uuid'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.uuid'></span>
    </label>
    <input type='text' id='node-config-input-uuid' data-i18n='[placeholder]asakusa_giken.placeholder.uuid'>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLECAST_BL',{
    category: 'config',
    defaults: {
      address: { value: '', required: true },
      uuid: { value: '', required: false }
    },
    label: function() {
      return this.address;
    },
    oneditprepare: function() {
      $('#node-config-input-address').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().replace(new RegExp('-', 'g'), ':').trim());
        }
      });
      $('#node-config-input-uuid').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().trim());
        }
      });
    }
  });
</script>


<!-- BLECAST_TM in -->
<script type='text/x-red' data-template-name='BLECAST_TM in'>
  <div class='form-row'>
    <label for='node-input-name'>
      <i class='fa fa-tag'></i>
      <span data-i18n='node-red:common.label.name'></span>
    </label>
    <input type='text' id='node-input-name' data-i18n='[placeholder]node-red:common.label.name'>
  </div>
  <div class="form-row node-input-blecastTm">
    <label for="node-input-blecastTm">
      <i class="fa fa-random"></i>
      <span data-i18n="asakusa_giken.label.blecastTm"></span></label>
    <input type="text" id="node-input-blecastTm">
  </div>
  <div class="form-row" id="node-useString">
    <label>&nbsp;</label>
    <input type="checkbox" id="node-input-useString" style="display: inline-block; width: auto; vertical-align: top;">
    <label for="node-input-useString" style="width: 70%;" data-i18n="asakusa_giken.label.useString"></label>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLECAST_TM in',{
    category: 'input',
    defaults: {
      name: { name: '' },
      blecastTm: { type: 'BLECAST_TM', required: true },
      useString: { value: false, required: false }
    },
    color: 'Gold',
    inputs: 0,
    outputs: 1,
    icon: "blecast_tm.png",
    label: function() {
      return this.name || 'BLECAST_TM';
    },
    labelStyle: function() {
      return this.name ? 'node_label_italic' : '';
    }
  });
</script>

<!-- BLECAST_TM -->
<script type='text/x-red' data-template-name='BLECAST_TM'>
  <div class='form-row'>
    <label for='node-config-input-address'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.address'></span>
    </label>
    <input type='text' id='node-config-input-address' data-i18n='[placeholder]asakusa_giken.placeholder.address'>
  </div>
  <div class='form-row'>
    <label for='node-config-input-uuid'>
      <i class='fa fa-random'></i>
      <span data-i18n='asakusa_giken.label.uuid'></span>
    </label>
    <input type='text' id='node-config-input-uuid' data-i18n='[placeholder]asakusa_giken.placeholder.uuid'>
  </div>
</script>

<script type='text/javascript'>
  RED.nodes.registerType('BLECAST_TM',{
    category: 'config',
    defaults: {
      address: { value: '', required: true },
      uuid: { value: '', required: false }
    },
    label: function() {
      return this.address;
    },
    oneditprepare: function() {
      $('#node-config-input-address').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().replace(new RegExp('-', 'g'), ':').trim());
        }
      });
      $('#node-config-input-uuid').blur(function() {
        var text = $(this).val();
        if (text && typeof(text) === 'string') {
          $(this).val(text.toLowerCase().trim());
        }
      });
    }
  });
</script>
